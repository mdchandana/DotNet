@model JqueryAjax.Models.Customer

@{
    ViewData["Title"] = "AllCustomersView";
}

<link href="~/lib/twitter-bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/lib/datatables/css/dataTables.bootstrap4.css" rel="stylesheet" />

<script src="~/lib/jquery/jquery.js"></script>
<script src="~/lib/datatables/js/jquery.dataTables.js"></script>
<script src="~/lib/datatables/js/dataTables.bootstrap4.js"></script>
<script src="~/lib/moment.js/moment-with-locales.js"></script>


@*<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
    <script src="https://editor.datatables.net/extensions/Editor/js/dataTables.editor.min.js"></script>*@

<br />
<h3 class="text-info">Customers</h3>
<br />

@*<div style="width:90%; margin:0 auto;" class="table-responsive border">
    <table id="customerDatatable" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">*@

<div class="form-group row">
    <label asp-for="Id" class="col-md-2"></label>
    <input asp-for="Id" class="form-control col-md-4" placeholder="Cust Id" readonly /> <br />
</div>
<div class="form-group row">
    <label asp-for="Name" class="col-md-2"></label>
    <input asp-for="Name" class="form-control col-md-4" placeholder="Name" /> <br />
</div>
<div class="form-group row">
    <label asp-for="Address" class="col-md-2"></label>
    <input asp-for="Address" class="form-control col-md-4" placeholder="Address" /> <br />
</div>
<div class="form-group row">
    <label asp-for="Contact" class="col-md-2"></label>
    <input asp-for="Contact" class="form-control col-md-4" placeholder="Contact" /> <br />
</div>
<div class="form-group row">
    <label asp-for="DateOfBirth" class="col-md-2"></label>
    <input asp-for="DateOfBirth" asp-format="{0:yyyy-MM-dd}" class="form-control col-md-4" placeholder="Date Of Birth" /> <br />
</div>
<div class="form-group">
    <button type="button" id="btnSave" class="btn btn-success">Save Customer</button>
    <button type="button" onclick="Reset()" class="btn btn-success">Reset</button>
</div>

<br />
<div class="table-responsive border">
    <table id="customerDatatable" class="table table-striped table-bordered dt-responsive nowrap">
        <thead>
            <tr class="text-info">
                <th>ID</th>
                <th>Name</th>
                <th>Address</th>
                <th>Contact</th>
                <th>Date Of Birth</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<br />
<br />

<script>

    var editor;

    $(document).ready(function () {
        //editor = new $.fn.dataTable.editor({
        //    table: '#customerDatatable',
        //    fields:
        //        [
        //            {
        //                label: 'Date Of Birth:',
        //                name: 'DateOfBirth',
        //                type: 'datetime',
        //                def: function () { return new Date(); },
        //                format: 'MM-DD-YYYY',
        //            }
        //        ]
        //});

        $('#customerDatatable').DataTable({

            "order": [[0, "desc"]],    //order by descending

            ajax: {
                url: "/Customer/GetCustomers",
                type: "GET",
                dataSrc: "data"
            },
            columns: [
                { data: "Id" },
                { data: "Name" },
                { data: "Address" },
                { data: "Contact" },
                {
                    data: "DateOfBirth", type:"date",
                    render: function (d) {
                        //return moment(d).format("DD-MM-YYYY");
                        return moment(d).format("YYYY-MM-DD");
                        //return moment(d).format("DD:MM:YYYY HH:mm:ss");
                    }
                },
                {
                    data: "Id", render: function (data, type, row, meta) {
                        return "<button class='btn btn-primary' style='margin-right:5px;' onclick=Edit(" + JSON.stringify(row) + ")>Edit</button>" +
                            "<button class='btn btn-danger' style='margin-right:5px;' onclick=Delete(" + JSON.stringify(row) + ")>Delete</button>"
                    }
                    //"render": function (data, row) { return "<a href='#' class='btn btn-danger' onclick=DeleteCustomer('" + row.FirstName + "'); >Delete</a>"; }
                }

            ]
        });


        $("#btnSave").click(function () {
            var customerData = {
                Id: $.trim($("#Id").val()) == "" ? 0 : $("#Id").val(),
                Name: $("#Name").val(),
                Address: $("#Address").val(),
                Contact: $("#Contact").val(),
                DateOfBirth: $("#DateOfBirth").val(),
            };

            ///==Worked
            //$.post("/Customer/SaveCustomer", { customer: customerData })
            //    .done(function (data) {
            //        Reset();
            //        ReloadGrid();
            //        alert("Saved");
            //    });

            $.ajax({
                url: "/Customer/SaveCustomer",
                method: "POST",
                data: customerData,
                success: function (response) {
                    Reset();
                    ReloadGrid();
                    alert("Customer Record Saved");
                }
            });
        });



    });




    var Edit = function (customerRow) {

        $("#Id").val(customerRow.Id);
        $("#Name").val(customerRow.Name);
        $("#Address").val(customerRow.Address);
        $("#Contact").val(customerRow.Contact);
        $("#DateOfBirth").val(customerRow.DateOfBirth);
    }

    function Delete(customerRow) {
        $.ajax({
            url: "/Customer/DeleteCustomer",
            method: "POST",
            data: { customerId: customerRow.Id },
            success: function (response) {
                alert('Deleted');
                ReloadGrid();
            }
        });
    }

    function Reset() {

        $("#Id").val(0);
        $("#Name").val("");
        $("#Address").val("");
        $("#Contact").val("");
        $("#DateOfBirth").val("");
    }

    function ReloadGrid() {
        $("#customerDatatable").DataTable().clear();
        $("#customerDatatable").DataTable().ajax.reload();

    }


//$(document).ready(function () {

//        $('#customerDatatable').DataTable({
//            "ajax": {
//                "url": "/Customer/LoadCustomers",
//                "type" :"POST",
//                "dataSrc" : "",
//            },
//            "columns": [
//                { data: "Id" },
//                { data: "FirstName" },
//                { data: "LastName" },
//                { data: "Contact" },
//                { data: "Email" },
//                { data: "DateOfBirth" }
//            ]
//        });
//    });


//$("#customerDatatable").DataTable({
//    "processing": true,
//    "serverSide": true,
//    "filter": true,
//    "ajax": {
//        "url": "/Customer/LoadCustomers",
//        "type": "POST",
//        "datatype": "json"
//    },
//    "columnDefs": [{
//        "targets": [0],
//        "visible": false,
//        "searchable": false
//    }],
//"columns": [
//    { "data": "id", "name": "Id", "autoWidth": true },
//    { "data": "firstName", "name": "First Name", "autoWidth": true },
//    { "data": "lastName", "name": "Last Name", "autoWidth": true },
//    { "data": "contact", "name": "Country", "autoWidth": true },
//    { "data": "email", "name": "Email", "autoWidth": true },
//    { "data": "dateOfBirth", "name": "Date Of Birth", "autoWidth": true },
//    {
//        "render": function (data, row) { return "<a href='#' class='btn btn-danger' onclick=DeleteCustomer('" + row.id + "'); >Delete</a>"; }
//    },
//]

//    "columns": [
//        { "data": "Id", "name": "Id", "autoWidth": true },
//        { "data": "FirstName", "name": "First Name", "autoWidth": true },
//        { "data": "LastName", "name": "Last Name", "autoWidth": true },
//        { "data": "Contact", "name": "Country", "autoWidth": true },
//        { "data": "Email", "name": "Email", "autoWidth": true },
//        { "data": "DateOfBirth", "name": "Date Of Birth", "autoWidth": true },
//        {
//            "render": function (data, row)
//            { return "<a href='#' class='btn btn-danger' onclick=DeleteCustomer('" + row.id + "'); >Delete</a>"; }
//        },
//    ]
//});

</script>


